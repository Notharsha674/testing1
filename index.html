<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kuk's Orange Quest!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
    <style>
        :root { --orange: #FF8C00; --pink: #FF1493; --purple: #8A2BE2; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Comic Sans MS', cursive, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            height: 100vh; overflow: hidden; display: flex;
            justify-content: center; align-items: center; position: relative;
            touch-action: none;
        }

        .container {
            text-align: center; z-index: 10; padding: 1.5rem;
            width: 90%; max-width: 400px; height: 80vh;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 40px; backdrop-filter: blur(20px);
            box-shadow: 0 15px 35px rgba(255, 105, 180, 0.3);
            border: 3px solid white;
            display: none; flex-direction: column; align-items: center; justify-content: space-between;
        }

        .active-page { display: flex; animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        h1 { font-size: 1.6rem; color: var(--pink); text-shadow: 0 2px 5px white; }
        .subtitle { color: var(--purple); font-weight: bold; font-size: 0.9rem; margin-bottom: 10px; }

        .btn {
            padding: 1rem 2rem; font-size: 1.2rem; font-weight: bold;
            background: linear-gradient(45deg, var(--pink), var(--purple));
            color: white; border: none; border-radius: 50px;
            box-shadow: 0 5px 15px rgba(255, 20, 147, 0.4);
            cursor: pointer; width: 90%;
        }

        .game-box { 
            position: relative; width: 100%; height: 280px; 
            background: #111; border-radius: 25px; 
            overflow: hidden; display: flex; align-items: center; justify-content: center;
        }

        /* Fixed Flashlight Layers */
        #flashlight { 
            position: absolute; width: 150px; height: 150px; 
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%; pointer-events: none; z-index: 8; 
        }
        #hidden-dino { 
            position: absolute; cursor: pointer; font-size: 3.5rem; 
            z-index: 7; opacity: 0; transition: opacity 0.2s; 
        }

        #glass { width: 80px; height: 120px; border: 4px solid white; border-top: none; border-radius: 0 0 20px 20px; position: relative; overflow: hidden; background: rgba(255,255,255,0.2); }
        #juice { position: absolute; bottom: 0; width: 100%; height: 0%; background: orange; transition: 0.1s; }

        .maze-wall { position: absolute; background: var(--purple); border-radius: 10px; }
        #maze-target { position: absolute; bottom: 10px; right: 10px; font-size: 2rem; }
        #maze-player { width: 45px; height: 45px; position: absolute; top: 10px; left: 10px; z-index: 20; touch-action: none; cursor: grab; }

        #mascot-container { position: fixed; bottom: 10px; left: 10px; z-index: 1000; display: none; }
        #mascot { width: 65px; border-radius: 15px; border: 3px solid white; box-shadow: 0 5px 10px rgba(0,0,0,0.2); }
        #speech { position: absolute; bottom: 80px; left: 0; background: white; padding: 12px; border-radius: 18px; font-size: 0.8rem; width: 150px; display: none; border: 2px solid var(--pink); font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        .letter-tile { width: 65px; height: 65px; background: white; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; color: var(--pink); box-shadow: 0 4px 10px rgba(0,0,0,0.1); touch-action: none; cursor: grab; }
    </style>
</head>
<body>

    <audio id="bg-music" loop src="Yellow.mp3"></audio>

    <div id="p1" class="container active-page">
        <div>
            <h1>Happy Birthday, Kuk! üéÇ</h1>
            <p class="subtitle">An interactive orange adventure!</p>
        </div>
        <img src="https://img.icons8.com/bubbles/200/birthday-cake.png" width="150">
        <button class="btn" onclick="nextPage(2)">START QUEST üçä</button>
    </div>

    <div id="p2" class="container">
        <h1>Step 1: Fresh Juice</h1>
        <p class="subtitle">HOLD the orange to fill the glass!</p>
        <div class="game-box" style="background: rgba(255,255,255,0.3);">
            <div id="glass"><div id="juice"></div></div>
            <div id="orange-btn" style="font-size: 4.5rem; margin-left: 20px; cursor: pointer;" onmousedown="startSqueeze()" ontouchstart="startSqueeze()" onmouseup="stopSqueeze()" ontouchend="stopSqueeze()">üçä</div>
        </div>
        <p id="juice-status" style="font-weight:bold; color:var(--orange);">0% Full</p>
    </div>

    <div id="p3" class="container">
        <h1>Step 2: Hide & Seek</h1>
        <p class="subtitle">Move your finger to find the Dino!</p>
        <div class="game-box" id="search-area" onmousemove="moveLight(event)" ontouchmove="moveLight(event)">
            <div id="flashlight" style="left: -200px; top: -200px;"></div>
            <div id="hidden-dino" onclick="nextPage(4)">ü¶ñ</div>
        </div>
    </div>

    <div id="p4" class="container">
        <h1>Step 3: The Maze</h1>
        <p class="subtitle">Drag the heart through the path!</p>
        <div class="game-box" id="maze-container" style="background: rgba(255,255,255,0.3);">
            <div class="maze-wall" style="width: 80%; height: 15px; top: 80px; left: 0;"></div>
            <div class="maze-wall" style="width: 80%; height: 15px; bottom: 100px; right: 0;"></div>
            <div id="maze-target">ü¶ñ</div>
            <div id="maze-player">‚ù§Ô∏è</div>
        </div>
    </div>

    <div id="p5" class="container">
        <h1>Step 4: Orange Pops</h1>
        <p class="subtitle">Pop them all to move on!</p>
        <div class="game-box" id="bubble-box" style="background: transparent; display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 15px;"></div>
    </div>

    <div id="p6" class="container">
        <h1>Step 5: Unlock the Name</h1>
        <p class="subtitle">Drag the letters to spell KUK!</p>
        <div class="game-box" style="background: transparent; flex-direction: column; gap: 30px;">
            <div style="display: flex; gap: 10px;" id="drop-zone">
                <div class="letter-tile" style="border: 3px dashed #ffb6c1; background: rgba(255,255,255,0.5);"></div>
                <div class="letter-tile" style="border: 3px dashed #ffb6c1; background: rgba(255,255,255,0.5);"></div>
                <div class="letter-tile" style="border: 3px dashed #ffb6c1; background: rgba(255,255,255,0.5);"></div>
            </div>
            <div style="display: flex; gap: 15px;" id="letter-dock">
                <div class="letter-tile" id="l1">U</div>
                <div class="letter-tile" id="l2">K</div>
                <div class="letter-tile" id="l3">K</div>
            </div>
        </div>
    </div>

    <div id="p7" class="container">
        <h1>Happy Birthday Kuk! üå∏</h1>
        <div style="overflow-y: auto; font-size: 1rem; color: #444; padding: 10px; line-height: 1.5;">
            You completed the Orange Quest! üçä<br><br>
            Kuk, you are a superstar. I hope this year brings you as much happiness as you give to others. You are perfect just the way you are! ‚ú®
        </div>
        <button class="btn" onclick="location.reload()">PLAY AGAIN? ü¶ñ</button>
    </div>

    <div id="mascot-container">
        <div id="speech"></div>
        <img id="mascot" src="dino.jpg">
    </div>

    <script>
        let juiceLevel = 0;
        let squeezeInterval;
        let bubblesPopped = 0;

        function nextPage(n) {
            if(n === 2) { 
                document.getElementById('bg-music').play();
                document.getElementById('mascot-container').style.display = 'block';
                showMascot("Let's go, Kuk! Squeeze the orange!");
            }
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active-page'));
            document.getElementById('p'+n).classList.add('active-page');
            
            if(n === 3) {
                initSearch();
                showMascot("Where am I? Use the light!");
            }
            if(n === 4) {
                initMaze();
                showMascot("Careful! Stay in the lines!");
            }
            if(n === 5) initBubbles();
            if(n === 6) {
                initScramble();
                showMascot("Spell your name!");
            }
        }

        function showMascot(text) {
            const s = document.getElementById('speech');
            s.innerText = text;
            s.style.display = 'block';
            setTimeout(() => s.style.display = 'none', 4000);
        }

        function startSqueeze() {
            squeezeInterval = setInterval(() => {
                if(juiceLevel < 100) {
                    juiceLevel += 2;
                    document.getElementById('juice').style.height = juiceLevel + '%';
                    document.getElementById('juice-status').innerText = juiceLevel + '% Full';
                    gsap.to("#orange-btn", {scale: 0.85, duration: 0.1});
                } else {
                    stopSqueeze();
                    nextPage(3);
                }
            }, 50);
        }
        function stopSqueeze() {
            clearInterval(squeezeInterval);
            gsap.to("#orange-btn", {scale: 1, duration: 0.1});
        }

        function initSearch() {
            const dino = document.getElementById('hidden-dino');
            dino.style.left = (20 + Math.random() * 60) + '%';
            dino.style.top = (20 + Math.random() * 60) + '%';
        }

        function moveLight(e) {
            e.preventDefault();
            const rect = document.getElementById('search-area').getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            
            gsap.to("#flashlight", {left: x - 75, top: y - 75, duration: 0.1});

            // Check if Dino is inside the light
            const dino = document.getElementById('hidden-dino');
            const dx = x - (dino.offsetLeft + 25);
            const dy = y - (dino.offsetTop + 25);
            const distance = Math.sqrt(dx*dx + dy*dy);

            if(distance < 70) {
                dino.style.opacity = "1";
            } else {
                dino.style.opacity = "0";
            }
        }

        function initMaze() {
            Draggable.create("#maze-player", {
                type: "x,y",
                bounds: "#maze-container",
                onDrag: function() {
                    if (this.hitTest("#maze-target", "50%")) {
                        this.disable();
                        nextPage(5);
                    }
                }
            });
        }

        function initBubbles() {
            const box = document.getElementById('bubble-box');
            box.innerHTML = '';
            for(let i=0; i<12; i++) {
                const b = document.createElement('div');
                b.style.width = '60px'; b.style.height = '60px';
                b.style.background = 'radial-gradient(circle at 30% 30%, #FFA500, #FF8C00)';
                b.style.borderRadius = '50%';
                b.style.boxShadow = 'inset -5px -5px 10px rgba(0,0,0,0.2), 5px 5px 10px rgba(0,0,0,0.1)';
                b.onclick = function() {
                    gsap.to(this, {scale: 1.5, opacity: 0, duration: 0.2});
                    bubblesPopped++;
                    if(bubblesPopped === 12) nextPage(6);
                };
                box.appendChild(b);
            }
        }

        function initScramble() {
            Draggable.create(".letter-tile", {
                bounds: "body",
                onRelease: function() {
                    if(this.y < -120) {
                        gsap.to(this.target, {scale: 0.8, opacity: 0.7});
                        if(document.querySelectorAll('.letter-tile[style*="opacity: 0.7"]').length === 3) {
                            setTimeout(() => nextPage(7), 800);
                        }
                    } else {
                        gsap.to(this.target, {x:0, y:0, duration: 0.3});
                    }
                }
            });
        }
    </script>
</body>
</html>
